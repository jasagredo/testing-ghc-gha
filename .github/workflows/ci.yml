name: Debugging with tmate

on: [push]

jobs:

  build:

    strategy:
      fail-fast: false
      matrix:
        ghc: ["9.2.8"]
        cabal: ["3.10.1.0"]
        sys:
          - { os: windows-latest, shell: 'C:/msys64/usr/bin/bash.exe -e {0}' }
    defaults:
        run:
          shell: ${{ matrix.sys.shell }}
    
    env:
      MSYSTEM: MINGW64
      # do not ever change to $HOME by yourself.
      CHERE_INVOKING: 1
      # do we want to inherit the path?
      MSYS2_PATH_TYPE: inherit
      # Modify this value to "invalidate" the secp cache.
      SECP_CACHE_VERSION: "2022-12-30"
      # current ref from: 27.02.2022
      SECP256K1_REF: ac83be33d0956faf6b7f61a60ab524ef7d6a473a

    runs-on: ${{ matrix.sys.os }}

    steps:
    - name: Install Base libs
      uses: input-output-hk/actions/base@90be550c9e4309032409e748acbaba6fa85ae793
      with:
        use-sodium-vrf: false

    - name: Install Haskell
      uses: input-output-hk/actions/haskell@a2b25bdbfa4aa4395faaee9140feb5f3179d59a4
      with:
        ghc-version: ${{ matrix.ghc }}
        cabal-version: ${{ matrix.cabal }}
        pacman-packages: >
          tree
          moreutils

    - name: Run
      run: |
        /usr/bin/tree .
